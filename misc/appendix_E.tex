\chapter{机器学习模型与阈值详情}

本节详述机器学习模型的具体架构。Malconv主要采用卷积神经网络设计，通过将恶意软件作为原始字节流处理进行分类。ResNet50分类器底层使用原始ResNet50模型[66]，该模型首先将恶意软件转换为灰度图像，再利用图像进行分类。而Malgraph模型不直接使用图像/可执行文件，它是一种分层图恶意软件分类器，采用两个基于图神经网络（GNN）的编码层：函数内层将单个函数的控制流图（CFG）编码为向量，函数间层则利用前层生成的向量及外部函数，对函数调用图（FCG）表征进行编码以学习全局程序表示。最终预测层对此嵌入向量应用多层感知机（MLP）计算恶意概率。

对于Malconv和MalGraph，我们采用文献[22]提供的现成实现，该模型基于文献[42]所引入的数据集训练——该数据集包含210,251个Windows可执行文件（101,641个恶意软件和108,610个正常软件），涵盖848个恶意软件家族。数据集构成与模型性能的补充细节详见[22]。针对ResNet50，我们采用预训练的ImageNet模型，基于文献[43]最新提出的恶意软件图像表征进行微调，该数据集包含恶意软件样本（2024年3月、4月、5月、7月和8月从MalwareBazaar\footnote{https://bazaar.abuse.ch/}收集）及对应正常软件。训练数据包含7,312个恶意软件实例和14,338个正常软件实例，恶意软件与正常软件比例为0.5:1。此训练分类器的性能在独立测试集上评估，该测试集包含9月恶意软件（同样采集自Malwarebazaar）和正常软件样本，恶意软件与正常软件比例为0.44:1（1,337个恶意软件和3,020个正常软件）。分类器在此测试集达到85\%准确率和85\% F1分数，更多细节参见[43]。

对于所有三个分类器，我们采用文献[22]设定的0.1\%误报率（FPR）阈值。恶意软件检测中需要低误报率以减少对良性文件的误判，但这也提高了决策阈值，可能导致更高的攻击成功率。此权衡关系已在先前研究[22]中被指出。针对Malconv和MalGraph，文献[22]提供的现成实现已包含0.1\% FPR阈值。对于微调后的ResNet50模型，我们通过选择良性测试集（仅用于阈值校准而非评估）上恶意软件概率的99.9百分位点计算等效阈值。在此模型特定阈值下，Malconv和ResNet50均未标记10个原始恶意软件样本，仅Malgraph标记了Fungus、Dexter、Conti和Babuk。故而我们将对抗评估集中于这四个样本变体。