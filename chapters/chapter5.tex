\chapter{评估}
在本节中，我们进行全面评估以回答以下问题：
• RQ1：LLMalMorph 生成的恶意软件变体对广泛使用的防病毒引擎和机器学习分类器的检测具有多强的抗性？其规避能力与最近的对抗性恶意软件生成框架生成的变体相比如何？
• RQ2：不同转换策略间的代码编辑工作量有何差异？这对揭示 LLM 所犯错误类型有何启示？
• RQ3：生成的恶意软件变体是否保留了原始样本的语义和功能？

\section{评估设置}

\subsection{选择样本}
由于最新的恶意软件源代码稀缺，大多数恶意软件研究都集中在可执行文件上。我们检查了公共数据库 [38], [39]，发现大多数可用的 Windows 恶意软件源代码是 32 位的，因此我们将研究重点放在 32 位变体上。我们选择了能够编译成可运行可执行文件、并表现出可通过 VirusTotal 或 Hybrid Analysis 检测到的恶意行为（其 AV 检测率≥60\%）的样本。这产生了十个具有不同复杂性和类型的恶意软件候选样本。RansomWar 样本使用 GCC 编译，其余样本使用 Microsoft Visual Studio 2022\footnote{https://visualstudio.microsoft.com/vs/}编译（因为提供了 .sln 文件）。表 II 总结了选定样本的关键细节。对于 Conti 和 Babuk 勒索软件，我们的分析集中在负责加密的加密器组件上。有关样本的详细信息请参见附录 B。

\subsection{评估指标}
我们使用给定的评估指标：防病毒（AV）检测率（$R^{\hat{Ms}}$）。我们使用 VirusTotal 评估 AV 检测率，该平台使用来自不同供应商的多个 AV 引擎扫描样本。每个样本可用的检测器数量因可用性而异。令 $D$ 为可用检测器的集合，$\hat{D} \subseteq D$ 为将恶意软件变体标记为恶意的检测器集合。在第 k 次运行时，变体 $\hat{M_{s}}$ 的 AV 检测率 $R^{\hat{M_{s}}}_{k}$ 定义为 $R^{\hat{M_{s}}}_{k} = \frac{|\hat{D}|}{|D|} \times 100$，其中 $|.|$ 表示两个集合的大小。

每个样本将进行$k$次运行，并计算平均检测率$R^{\hat{M_{s}}}=\frac{1}{k} \sum_{i=1}^{k} R_{k}^{\hat{M_{s}}}$。我们在实验中设定 k=3 以解释不同运行间的变异性。我们还使用 Hybrid Analysis，该工具包含静态分析、基于机器学习的分析以及使用不同引擎的多重扫描分析。检测性能以每个恶意软件样本及其变体在 k 次运行上的平均百分比表示。我们使用这两个工具的免费版本，并通过其各自的 API 自动化样本上传、结果检索和后处理。

\subsection{策略导向的机器学习分类器攻击成功率 (ASR)}
攻击成功率 (Attack Success Rate, ASR) 是评估对抗攻击的广泛使用的指标 [20], [40]，即生成的恶意软件变体成功逃避目标系统检测的比例。我们针对三种基于机器学习的恶意软件分类器评估 ASR：Malconv [41]、Malgraph [42] 和一个训练好的 ResNet50 恶意软件分类器 [43]。模型细节详见附录 E。令 M 为一个原始恶意软件样本，将我们的策略 s 应用于所有修改文件 $\hat{F} \subseteq F$ 并为 $j$ 个转换函数生成变体 $V_{s}^{M} = \{\hat{M_{1}}, \hat{M_{2}}, ..., \hat{M_{j}}\}$。对于给定的目标分类器 $C$，令 $\hat{V_{s,C}^{M}} = \{ \hat{M} \in V_{s}^{M} : C(\hat{M}) = benign\}$ 为成功逃避 $C$ 的变体子集。则攻击成功率为 $ASR = \frac{|\hat{V_{s,C}^{M}}|}{|V_{s}^{M}|} \times 100$。其中 $|.|$ 表示集合的大小。

\subsection{策略导向的代码编辑工作量 ($W_{s}^{M}$)}
该指标基于需要手动编辑以编译LLM生成代码的总代码行数来比较策略 $s$。值越高表明需要更广泛的手动干预，意味着LLM在该策略下犯了更严重的错误。对于给定的恶意软件 $M$，令 $\hat{F} \subseteq F$ 表示 $F$ 个文件中被修改的文件数量。恶意软件 $M$ 和策略 $s$ 的编辑工作量 $W_s^{M}$ 定义为在文件 $\hat{F}$ 中所有转换后的函数 $\{f_{1}^{i}, f_{2}^{i}... f_{j}^{i}\}$ 上编辑（添加、修改或删除）的总代码行数，计算公式为 $W_{s}^{M}=\sum_{i=1}^{\hat{F}} \sum_{t=1}^{j} L_{edit}(f_{t}^{i})$，其中 $L_{edit}$ 统计函数 $\hat{f_{t}^{i}}$ 被编辑代码的行数。

\subsection{人力投入量化指标 ($H_{s}^{M}$)}
该指标衡量针对每种策略调试和配置恶意软件中转换后函数所需的人力投入。它量化了生成一个成功编译的 PE 文件所需的总工时。对于给定的恶意软件 $M$ 和代码转换策略 $s$，人力投入 $H_{s}^{M}$ 的计算公式为 $H_{s}^{M} = \sum_{i=1}^{\hat{F}} \sum_{t=1}^{j} ManHours(\hat{f_{t}^{i}})$。此处，求和表示在策略 $s$ 下，在修改文件 $\hat{F}$ 中所有转换后的函数 $\{f_{1}^{i},f_{2}^{i}...f_{j}^{i}\}$ 上所花费的总工时。